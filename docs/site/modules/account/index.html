<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí≥ ACCOUNT - Gu√≠a de Historias de Usuario</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f6fb;
            color: #1f2933;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }
        .header {
            background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.25);
            margin-bottom: 32px;
        }
        .header h1 {
            margin-bottom: 8px;
            font-size: 2.6rem;
        }
        .header p {
            margin: 0;
            opacity: 0.9;
        }
        section {
            background: white;
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 5px 14px rgba(15, 23, 42, 0.12);
        }
        section h2 {
            color: #1d4ed8;
            margin-bottom: 16px;
            font-size: 1.8rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        .card {
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 18px;
            background: #f8fafc;
        }
        .card h3 {
            margin-top: 0;
            color: #0f172a;
            font-size: 1.2rem;
        }
        ul {
            padding-left: 1rem;
        }
        li {
            margin-bottom: 8px;
        }
        pre {
            background: #0f172a;
            color: #f1f5f9;
            border-radius: 10px;
            padding: 16px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background: #1d4ed8;
            color: white;
        }
        footer {
            text-align: center;
            padding: 24px 0;
            font-size: 0.9rem;
            color: #475467;
        }
        footer a {
            color: #1d4ed8;
            text-decoration: none;
            font-weight: 600;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 6px;
            margin-top: 4px;
        }
        .badge.simple { background: #d1fae5; color: #047857; }
        .badge.medium { background: #fef3c7; color: #92400e; }
        .badge.complex { background: #fee2e2; color: #b91c1c; }
        .link-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 12px;
        }
        .link-row a {
            color: #1d4ed8;
            font-weight: 600;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üí≥ ACCOUNT</h1>
            <p>Gu√≠a pr√°ctica para crear User Stories centradas en consultas y actualizaciones de cuentas.</p>
            <p style="margin-top: 10px; font-size: 1rem; opacity: 0.9;">
                Permite ver balances, l√≠mites, clientes, tarjetas y ejecutar modificaciones transaccionales sin salir del m√≥dulo.
            </p>
        </header>

        <section>
            <h2>üìã Overview & Business Context</h2>
            <p>Account es el m√≥dulo de back-office que expone los detalles financieros y demogr√°ficos de cada cuenta, apoya a los equipos de servicio al cliente y al cumplimiento, y provee datos a m√≥dulos relacionados (Credit Card, Transaction, Bill Payment).</p>
            <ul>
                <li>Informe de balances, l√≠mites y cr√©dito disponible con datos enmascarados.</li>
                <li>Actualizaciones guiadas por validaciones de negocio (SSN, FICO, ZIP, status).</li>
                <li>Transacciones at√≥micas de Account + Customer con bloqueo pesimista y rollbacks.</li>
            </ul>
        </section>

        <section>
            <h2>üéØ Gu√≠a de Historias de Usuario</h2>
            <div class="grid">
                <div class="card">
                    <h3>Inquiry - Simple (1-2 pts)</h3>
                    <p>Como representante de servicio, quiero buscar una cuenta por su ID de 11 d√≠gitos para mostrar saldo, l√≠mite y tarjetas y poder resolver dudas.</p>
                </div>
                <div class="card">
                    <h3>Update - Medio (3-5 pts)</h3>
                    <p>Como administrador, quiero editar el l√≠mite de cr√©dito y la direcci√≥n del cliente para reflejar cambios crediticios verificables.</p>
                </div>
                <div class="card">
                    <h3>Compliance - Simple (1-2 pts)</h3>
                    <p>Como oficial de cumplimiento, quiero que SSN y tarjetas aparezcan enmascaradas y que no puedan copiarse para cumplir PCI.</p>
                </div>
                <div class="card">
                    <h3>Workflow Complejo (5-8 pts)</h3>
                    <p>Como supervisor, quiero aprobar cambios con cr√©dito disponible > $10,000 y registrar auditor√≠a en la misma transacci√≥n.</p>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <span class="badge simple">Simple</span>
                <span class="badge medium">Medio</span>
                <span class="badge complex">Complejo</span>
                <p style="margin-top: 12px;">Simple: ajustes ligeros sobre la UI o campos legibles. Medio: validaciones o nuevos campos editables. Complejo: integraciones con scoring externo o aprobaciones transversales.</p>
            </div>
        </section>

        <section>
            <h2>‚ö° Factores de Aceleraci√≥n</h2>
            <ul>
                <li><strong>`useAccountView`</strong> encapsula carga, errores y validaci√≥n de b√∫squeda, ideal para replicar en otros m√≥dulos.</li>
                <li><strong>`useAccountUpdate`</strong> compara payloads para evitar env√≠os innecesarios y detectar cambios reales.</li>
                <li><strong>Hooks + Material-UI</strong> permiten construir pantallas completas sin componentes base adicionales.</li>
                <li><strong>Servicios de backend</strong> (`AccountViewService`, `AccountUpdateService`, `AccountValidationService`) separan l√≥gica de agregaci√≥n, transacci√≥n y validaciones.</li>
                <li><strong>Documentaci√≥n de APIs</strong> con esquemas JSON claros acelera consumo frontend/back.</li>
            </ul>
        </section>

        <section>
            <h2>üîß Fundaci√≥n T√©cnica</h2>
            <div class="grid">
                <div class="card">
                    <h3>Key Components</h3>
                    <ul>
                        <li><strong>AccountViewScreen.tsx</strong>: grid de tarjetas, b√∫squeda y tablero de indicadores.</li>
                        <li><strong>AccountUpdateScreen.tsx</strong>: modo edici√≥n con confirmaci√≥n y restauraci√≥n.</li>
                        <li><strong>AccountViewService</strong>: lectura multi-tabla (CardXref ‚Üí Account ‚Üí Customer).</li>
                        <li><strong>AccountUpdateService</strong>: actualizaci√≥n transaccional con rollback y locks.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Dependencias</h3>
                    <ul>
                        <li>Material-UI (TextField, Card, Button, Grid, IconButton)</li>
                        <li>Redux Toolkit (authSlice, opcionales para estado global)</li>
                        <li>MSW para mocks con delays 300-800 ms</li>
                        <li>PostgreSQL con √≠ndices en `accountId`, `customerId`, `cardNumber`</li>
                    </ul>
                </div>
            </div>
            <h3>APIs clave</h3>
            <pre><code>GET  /api/account/acccount?accountId={id}  ‚Üí Devuelve Account + Customer + Cards en JSON con m√°scaras
PUT  /api/account/update                ‚Üí Actualiza Account + Customer (transaccional)</code></pre>
            <h3>Modelos de datos esenciales</h3>
            <pre><code>interface Account { accountId: string; balance: number; creditLimit: number; availableCredit: number; status: string; customer: Customer; cards: CreditCard[]; }</code></pre>
        </section>

        <section>
            <h2>üìã Reglas de Negocio</h2>
            <ul>
                <li>`accountId`: 11 d√≠gitos, no puede ser 00000000000.</li>
                <li>Solo `status='Y'` participa en operaciones activas.</li>
                <li>`balance` puede ser negativo; `availableCredit = creditLimit - balance`.</li>
                <li>SSN y tarjetas siempre aparecen con m√°scara (***-**-XXXX / ****-****-****-XXXX).</li>
                <li>FICO: 300-850. ZIP: `^\d{5}(-\d{4})?$`.</li>
                <li>Actualizaciones leen con `READ FOR UPDATE` y son completamente at√≥micas.</li>
            </ul>
        </section>

        <section>
            <h2>üìà Patrones de Criterios de Aceptaci√≥n</h2>
            <div class="grid">
                <div class="card">
                    <h3>Autenticaci√≥n</h3>
                    <p>Dado un usuario autenticado, entonces el m√≥dulo se carga y redirige si la sesi√≥n expira.</p>
                </div>
                <div class="card">
                    <h3>Validaci√≥n</h3>
                    <p>Dado un Account ID incorrecto, entonces se muestra el mensaje ‚ÄúMust be 11 digits‚Äù.</p>
                </div>
                <div class="card">
                    <h3>Performance</h3>
                    <p>Dado un accountId v√°lido, entonces la consulta responde en &lt; 500ms (P95).</p>
                </div>
                <div class="card">
                    <h3>Manejo de errores</h3>
                    <p>Dado que la cuenta no existe en CardXref, entonces debe mostrarse ‚ÄúAccount not found in Cross ref file‚Äù.</p>
                </div>
            </div>
        </section>

        <section>
            <h2>‚ö° Rendimiento & Riesgos</h2>
            <ul>
                <li>Response budget: GETs < 500 ms, PUTs < 1 s (P95).</li>
                <li>Escalar con caching/replicas cuando la tabla `CardXref` crezca.</li>
                <li>Riesgo: sin notificaciones globales a√∫n; se recomienda implementar snackbar (ej. notistack).</li>
                <li>Riesgo: validaci√≥n manual; considerar shared validator para evitar duplicaci√≥n.</li>
            </ul>
        </section>

        <section>
            <h2>üí° C√≥digo y Referencias</h2>
            <p>Hook de b√∫squeda real utilizado como plantilla:</p>
            <pre><code>// useAccountView.ts
export function useAccountView() {
  const [data, setData] = useState<AccountViewResponse | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const searchAccount = async (accountId: string) => {
    setLoading(true);
    try {
      if (!/^\d{11}$/.test(accountId)) throw new Error('Account must be 11 digits');
      const response = await api.get<AccountViewResponse>(`/account/acccount?accountId=${accountId}`);
      setData(response.data);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return { data, loading, error, searchAccount };
}</code></pre>
            <p>Validate the payload with `AccountValidationService` before saving to ensure FICO, ZIP, and yes/no values remain consistent.</p>
        </section>

        <section>
            <h2>üìä Tabla de Validaciones</h2>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Validaci√≥n</th>
                        <th>Regla</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Account ID</td><td><code>^\d{11}$</code></td><td>11 d√≠gitos, no puede ser 00000000000</td></tr>
                    <tr><td>Status</td><td>Dropdown</td><td>Y (activo) o N (inactivo)</td></tr>
                    <tr><td>Credit Limit</td><td>Num√©rico</td><td>Mayor a 0</td></tr>
                    <tr><td>FICO Score</td><td>300-850</td><td>Referencia de cr√©dito</td></tr>
                    <tr><td>ZIP</td><td><code>^\d{5}(-\d{4})?$</code></td><td>Formato US ZIP</td></tr>
                    <tr><td>SSN/Card</td><td>Enmascarado</td><td>No exponer datos completos</td></tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>üìö M√°s Detalles</h2>
            <p>La descripci√≥n completa del m√≥dulo, incluyendo cat√°logos, reglas y m√©tricas de rendimiento, est√° disponible en el Markdown oficial.</p>
            <div class="link-row">
                <a href="../../modules/account/account-overview.md">Abrir account-overview.md</a>
                <a href="../../system-overview.md">Volver al System Overview</a>
            </div>
        </section>

        <footer>
            <p>Precisi√≥n del m√≥dulo: 95%+ seg√∫n an√°lisis directo del c√≥digo fuente.</p>
            <p><em>√öltima actualizaci√≥n: 2026-01-26</em></p>
        </footer>
    </div>
</body>
</html>
